Budget Manager JavaScript Guide
============================

This guide explains the JavaScript functionality used in our Budget Manager application, with practical examples and explanations for beginners.

1. Core Concepts
--------------
1.1 Variables and State Management:
```javascript
// State management for transactions
let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;

// DOM Elements
const balanceEl = document.getElementById('balance');
const transactionList = document.getElementById('transactionList');
const addTransactionBtn = document.getElementById('addTransactionBtn');
```

1.2 Event Listeners:
```javascript
// Basic event listener setup
document.addEventListener('DOMContentLoaded', initializeApp);
addTransactionBtn.addEventListener('click', openTransactionModal);
transactionForm.addEventListener('submit', handleTransactionSubmit);

// Example of event delegation for dynamic elements
transactionList.addEventListener('click', (e) => {
    if (e.target.classList.contains('delete-btn')) {
        const transactionId = e.target.dataset.id;
        deleteTransaction(transactionId);
    }
});
```

2. Data Management
----------------
2.1 Adding Transactions:
```javascript
function addTransaction(transaction) {
    // Input validation
    if (!transaction.amount || !transaction.description) {
        showError('Please fill in all fields');
        return;
    }

    // Create transaction object
    const newTransaction = {
        id: generateUniqueId(),
        amount: parseFloat(transaction.amount),
        description: transaction.description,
        category: transaction.category,
        type: transaction.type,
        date: new Date().toISOString(),
        userId: currentUser.id
    };

    // Update state and storage
    transactions.push(newTransaction);
    saveTransactions();
    updateUI();
}
```

2.2 Local Storage Operations:
```javascript
function saveTransactions() {
    try {
        localStorage.setItem('transactions', JSON.stringify(transactions));
    } catch (error) {
        console.error('Error saving transactions:', error);
        showError('Failed to save transaction');
    }
}

function loadTransactions() {
    try {
        const stored = localStorage.getItem('transactions');
        return stored ? JSON.parse(stored) : [];
    } catch (error) {
        console.error('Error loading transactions:', error);
        return [];
    }
}
```

3. UI Updates and DOM Manipulation
-------------------------------
3.1 Rendering Transactions:
```javascript
function renderTransactions() {
    const transactionList = document.getElementById('transactionList');
    
    // Clear existing content
    transactionList.innerHTML = '';
    
    // Sort transactions by date
    const sortedTransactions = transactions
        .slice()
        .sort((a, b) => new Date(b.date) - new Date(a.date));
    
    // Create and append transaction elements
    sortedTransactions.forEach(transaction => {
        const element = createTransactionElement(transaction);
        transactionList.appendChild(element);
    });
}

function createTransactionElement(transaction) {
    const div = document.createElement('div');
    div.className = `transaction-item ${transaction.type}`;
    
    div.innerHTML = `
        <div class="transaction-info">
            <span class="description">${escapeHtml(transaction.description)}</span>
            <span class="date">${formatDate(transaction.date)}</span>
        </div>
        <div class="transaction-amount">
            ${formatCurrency(transaction.amount)}
        </div>
        <button class="delete-btn" data-id="${transaction.id}">
            <i class="fas fa-trash"></i>
        </button>
    `;
    
    return div;
}
```

3.2 Modal Management:
```javascript
function openTransactionModal() {
    const modal = document.getElementById('transactionModal');
    modal.style.display = 'block';
    
    // Reset form
    document.getElementById('transactionForm').reset();
    
    // Focus first input
    document.getElementById('description').focus();
}

function closeTransactionModal() {
    const modal = document.getElementById('transactionModal');
    modal.style.display = 'none';
}

// Close modal when clicking outside
window.addEventListener('click', (e) => {
    const modal = document.getElementById('transactionModal');
    if (e.target === modal) {
        closeTransactionModal();
    }
});
```

4. Chart Management
-----------------
4.1 Chart Initialization:
```javascript
function initializeChart() {
    const ctx = document.getElementById('expenseChart').getContext('2d');
    
    // Destroy existing chart if it exists
    if (window.expenseChart) {
        window.expenseChart.destroy();
    }
    
    const chartData = calculateChartData();
    
    window.expenseChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: chartData.labels,
            datasets: [{
                data: chartData.values,
                backgroundColor: chartData.colors
            }]
        },
        options: {
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const value = context.raw;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${formatCurrency(value)} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
}
```

4.2 Chart Data Calculation:
```javascript
function calculateChartData() {
    const categories = {};
    const colors = {
        Food: '#FF6384',
        Transport: '#36A2EB',
        Utilities: '#FFCE56',
        Entertainment: '#4BC0C0',
        Others: '#9966FF'
    };

    // Calculate totals per category
    transactions
        .filter(t => t.type === 'expense')
        .forEach(t => {
            categories[t.category] = (categories[t.category] || 0) + t.amount;
        });

    return {
        labels: Object.keys(categories),
        values: Object.values(categories),
        colors: Object.keys(categories).map(cat => colors[cat] || '#808080')
    };
}
```

5. Utility Functions
------------------
5.1 Formatting Functions:
```javascript
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
    }).format(amount);
}

function formatDate(dateString) {
    return new Intl.DateTimeFormat('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    }).format(new Date(dateString));
}

function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}
```

5.2 Validation and Error Handling:
```javascript
function validateTransaction(transaction) {
    const errors = [];
    
    if (!transaction.description.trim()) {
        errors.push('Description is required');
    }
    
    if (isNaN(transaction.amount) || transaction.amount <= 0) {
        errors.push('Amount must be a positive number');
    }
    
    if (!['income', 'expense'].includes(transaction.type)) {
        errors.push('Invalid transaction type');
    }
    
    return errors;
}

function showError(message) {
    const errorDiv = document.getElementById('errorMessage');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    
    setTimeout(() => {
        errorDiv.style.display = 'none';
    }, 3000);
}
```

6. Advanced Features
-----------------
6.1 Search and Filter:
```javascript
function searchTransactions(query) {
    return transactions.filter(t => 
        t.description.toLowerCase().includes(query.toLowerCase()) ||
        t.category.toLowerCase().includes(query.toLowerCase())
    );
}

function filterByDateRange(startDate, endDate) {
    return transactions.filter(t => {
        const date = new Date(t.date);
        return date >= startDate && date <= endDate;
    });
}
```

6.2 Data Export:
```javascript
function exportTransactions() {
    const data = JSON.stringify(transactions, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `transactions_${formatDate(new Date())}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
```

7. Testing and Debugging
----------------------
7.1 Console Logging:
```javascript
function debugTransaction(transaction) {
    console.group('Transaction Debug');
    console.log('Transaction:', transaction);
    console.log('Validation:', validateTransaction(transaction));
    console.log('Current State:', transactions);
    console.groupEnd();
}
```

7.2 Performance Monitoring:
```javascript
function measurePerformance(functionName, callback) {
    console.time(functionName);
    callback();
    console.timeEnd(functionName);
}
```

Remember:
--------
1. Always validate user input
2. Use try-catch blocks for error handling
3. Keep functions small and focused
4. Comment complex logic
5. Use consistent naming conventions
6. Test edge cases
7. Optimize performance for large datasets

Additional Resources:
------------------
1. MDN JavaScript Reference: https://developer.mozilla.org/en-US/docs/Web/JavaScript
2. Chart.js Documentation: https://www.chartjs.org/docs/
3. JavaScript Best Practices: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide
4. Web Storage API: https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API

Keep Learning!
-------------
Programming is a journey of continuous learning. Don't be afraid to experiment and make mistakes - they're valuable learning opportunities!

18. Interactive Examples
---------------------
1. Working with the DOM:
   ```javascript
   // Finding elements
   const element = document.querySelector('.transaction-item');  // By class
   const elements = document.querySelectorAll('.amount');       // All matching
   const byId = document.getElementById('totalIncome');         // By ID
   
   // Changing content
   element.textContent = 'New text';              // Just text
   element.innerHTML = '<span>New HTML</span>';   // With HTML
   
   // Changing styles
   element.style.color = 'red';
   element.classList.add('highlight');
   element.classList.remove('hidden');
   ```

2. Working with Arrays:
   ```javascript
   // Different ways to add items
   transactions.push(newTransaction);     // Add to end
   transactions.unshift(newTransaction);  // Add to start
   
   // Finding items
   const found = transactions.find(t => t.id === 123);
   const index = transactions.findIndex(t => t.id === 123);
   
   // Transforming data
   const descriptions = transactions.map(t => t.description);
   const total = transactions.reduce((sum, t) => sum + t.amount, 0);
   ```

19. More Practical Exercises
-------------------------
1. Basic: "Show Transaction Count"
   ```javascript
   function getTransactionCounts() {
       const income = transactions.filter(t => t.type === 'income').length;
       const expenses = transactions.filter(t => t.type === 'expense').length;
       return { income, expenses };
   }
   ```

2. Intermediate: "Category Summary"
   ```javascript
   function getCategorySummary() {
       const summary = {};
       transactions.forEach(t => {
           if (!summary[t.category]) {
               summary[t.category] = {
                   count: 0,
                   total: 0,
                   average: 0
               };
           }
           summary[t.category].count++;
           summary[t.category].total += t.amount;
           summary[t.category].average = 
               summary[t.category].total / summary[t.category].count;
       });
       return summary;
   }
   ```

3. Advanced: "Smart Budget Recommendations"
   ```javascript
   function getBudgetRecommendations() {
       const categorySummary = getCategorySummary();
       const recommendations = [];
       
       Object.entries(categorySummary).forEach(([category, data]) => {
           if (data.total > 5000) {
               const savingTarget = data.total * 0.1;  // 10% reduction
               recommendations.push({
                   category,
                   message: `Consider reducing ${category} spending by ₦${savingTarget}`,
                   currentSpending: data.total,
                   targetReduction: savingTarget
               });
           }
       });
       return recommendations;
   }
   ```

20. Real-World Scenarios
---------------------
1. Handling Network Issues:
   ```javascript
   async function syncTransactions() {
       try {
           // Try to save to cloud backup
           await saveToCloud(transactions);
           console.log('Backup successful');
       } catch (error) {
           // If network fails, save locally
           localStorage.setItem('pendingSync', JSON.stringify(transactions));
           console.log('Saved locally, will sync later');
       }
   }
   ```

2. Data Import/Export:
   ```javascript
   function exportTransactions() {
       const data = JSON.stringify(transactions, null, 2);
       const blob = new Blob([data], { type: 'application/json' });
       const url = URL.createObjectURL(blob);
       
       const link = document.createElement('a');
       link.href = url;
       link.download = 'budget_data.json';
       link.click();
   }
   ```

3. Smart Date Handling:
   ```javascript
   function getRelativeDate(dateString) {
       const date = new Date(dateString);
       const now = new Date();
       const diff = now - date;
       
       if (diff < 86400000) return 'Today';
       if (diff < 172800000) return 'Yesterday';
       return formatDate(date);
   }
   ```

21. Advanced Chart Features
------------------------
1. Custom Tooltips:
   ```javascript
   const chartOptions = {
       plugins: {
           tooltip: {
               callbacks: {
                   label: function(context) {
                       const value = context.raw;
                       const total = context.dataset.data.reduce((a, b) => a + b);
                       const percentage = ((value / total) * 100).toFixed(1);
                       return `₦${value.toLocaleString()} (${percentage}%)`;
                   }
               }
           }
       }
   };
   ```

2. Interactive Legend:
   ```javascript
   const chart = new Chart(ctx, {
       plugins: [{
           id: 'customLegend',
           afterDraw(chart) {
               const {ctx, data} = chart;
               data.datasets[0].data.forEach((value, i) => {
                   const category = data.labels[i];
                   // Draw custom legend item
               });
           }
       }]
   });
   ```

22. Performance Optimization Examples
---------------------------------
1. Efficient DOM Updates:
   ```javascript
   // Bad: Updates DOM in loop
   transactions.forEach(t => {
       document.getElementById('list').innerHTML += createTransactionHTML(t);
   });
   
   // Good: Batch DOM updates
   const html = transactions.map(t => createTransactionHTML(t)).join('');
   document.getElementById('list').innerHTML = html;
   ```

2. Smart Event Listeners:
   ```javascript
   // Bad: Multiple listeners
   transactions.forEach(t => {
       document.querySelector(`#transaction-${t.id}`).addEventListener('click', handleClick);
   });
   
   // Good: Event delegation
   document.getElementById('transactionList').addEventListener('click', (e) => {
       const transactionEl = e.target.closest('.transaction-item');
       if (transactionEl) handleClick(transactionEl.dataset.id);
   });
   ```

23. Testing Your Code
------------------
1. Basic Function Testing:
   ```javascript
   function testAddTransaction() {
       console.log('Testing addTransaction...');
       
       // Test case 1: Valid transaction
       const before = transactions.length;
       addTransaction({
           description: 'Test',
           amount: 1000,
           type: 'income'
       });
       console.assert(
           transactions.length === before + 1,
           'Transaction should be added'
       );
       
       // Test case 2: Invalid amount
       try {
           addTransaction({
               description: 'Test',
               amount: -1000,
               type: 'income'
           });
           console.error('Should have thrown error for negative amount');
       } catch (e) {
           console.log('Successfully caught negative amount');
       }
   }
   ```

Remember:
---------
- Code organization is key to maintainability
- Always validate user input
- Test your code thoroughly
- Keep your code DRY (Don't Repeat Yourself)
- Comment your code, but make the code self-documenting
- Use meaningful variable and function names
- Break complex problems into smaller, manageable pieces

Keep practicing and experimenting with these examples!
